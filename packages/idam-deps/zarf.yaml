# yaml-language-server: $schema=https://raw.githubusercontent.com/defenseunicorns/zarf/main/zarf.schema.json
kind: ZarfPackageConfig
metadata:
  name: software-factory-idam-deps
  description: "Imports realm for keycloak to import and creates internal DNS entries to auth callbacks"
  version: "1.0.0"
  architecture: amd64

components:
  - name: realm-and-dns-script
    required: true
    files:
      - source: files/baby-yoda.json
        target: baby-yoda.json
      - source: files/coredns-add-hostname.sh
        target: coredns-add-hostname.sh
        executable: true

  - name: create-internal-dns-entries
    required: false
    actions:
      onDeploy:
        after:
          - cmd: ./coredns-add-hostname.sh

  - name: exported-variables
    required: false
    actions:
      onDeploy:
        after:
          # Set generic IDAM_ENABLED to true for export
          - cmd: echo baby-yoda.json
            setVariables:
              - name: REALM_IMPORT_FILE

