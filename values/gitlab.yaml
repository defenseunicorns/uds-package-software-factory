hostname: ###ZARF_VAR_DOMAIN###
domain: ###ZARF_VAR_DOMAIN###

global:
  psql:
    host: gitlab-postgres
    port: 5432
    database: gitlab-uds-software-factory
    username: gitlab
    password:
      useSecret: true
      secret: gitlab-postgres
      key: password
  redis:
    host: gitlab-redis
    port: 6379
    auth:
      enabled: true
      secret: gitlab-redis
      key: password
  minio:
    enabled: false
  appConfig:
    omniauth:
      enabled: true
      allowSingleSignOn: ['openid_connect']
      blockAutoCreatedUsers: false
      providers:
        - secret: gitlab-sso-provider
          key: gitlab-sso.json
    object_store:
      enabled: true
      proxy_download: true
      connection:
        secret: gitlab-object-store
        key: connection
  # added to help with Gitlab sub-chart configuration
  image:
    pullPolicy: IfNotPresent
  istio:
    enabled: true
    injection: enabled
  hosts:
    domain: ###ZARF_VAR_DOMAIN###

    gitlab:
      name: gitlab.###ZARF_VAR_DOMAIN###

    registry:
      name: registry.###ZARF_VAR_DOMAIN###
  registry:
    relativeurls: true

postgresql:
  install: false
redis:
  install: false

registry:
  storage:
    secret: gitlab-object-store
    key: registry
  metrics:
    serviceMonitor:
      endpointConfig:
        scheme: https
        tlsConfig:
          caFile: /etc/prom-certs/root-cert.pem
          certFile: /etc/prom-certs/cert-chain.pem
          keyFile: /etc/prom-certs/key.pem
          insecureSkipVerify: true  # Prometheus does not support Istio security naming, thus skip verifying target pod certificate


gitlab:
  toolbox:
    backups:
      objectStorage:
        config:
          secret: gitlab-object-store
          key: backups
  gitlab-exporter:
    enabled: true
    metrics:
      serviceMonitor:
        endpointConfig:
          scheme: https
          tlsConfig:
            caFile: /etc/prom-certs/root-cert.pem
            certFile: /etc/prom-certs/cert-chain.pem
            keyFile: /etc/prom-certs/key.pem
            insecureSkipVerify: true  # Prometheus does not support Istio security naming, thus skip verifying target pod certificate
  webservice:
    metrics:
      serviceMonitor:
        endpointConfig:
          scheme: https
          tlsConfig:
            caFile: /etc/prom-certs/root-cert.pem
            certFile: /etc/prom-certs/cert-chain.pem
            keyFile: /etc/prom-certs/key.pem
            insecureSkipVerify: true  # Prometheus does not support Istio security naming, thus skip verifying target pod certificate
    workhorse:
      metrics:
        serviceMonitor:
          endpointConfig:
            scheme: https
            tlsConfig:
              caFile: /etc/prom-certs/root-cert.pem
              certFile: /etc/prom-certs/cert-chain.pem
              keyFile: /etc/prom-certs/key.pem
              insecureSkipVerify: true  # Prometheus does not support Istio security naming, thus skip verifying target pod certificate
  gitaly:
    metrics:
      serviceMonitor:
        endpointConfig:
          scheme: https
          tlsConfig:
            caFile: /etc/prom-certs/root-cert.pem
            certFile: /etc/prom-certs/cert-chain.pem
            keyFile: /etc/prom-certs/key.pem
            insecureSkipVerify: true  # Prometheus does not support Istio security naming, thus skip verifying target pod certificate
  gitlab-shell:
    metrics:
      serviceMonitor:
        endpointConfig:
          scheme: https
          tlsConfig:
            caFile: /etc/prom-certs/root-cert.pem
            certFile: /etc/prom-certs/cert-chain.pem
            keyFile: /etc/prom-certs/key.pem
            insecureSkipVerify: true  # Prometheus does not support Istio security naming, thus skip verifying target pod certificate

openshift: false

istio:
  enabled: true
  injection: enabled
  gitlab:
    gateways:
    - istio-system/tenant
  registry:
    gateways:
    - istio-system/tenant

monitoring:
  enabled: true

networkPolicies:
  enabled: true
  ingressLabels:
    app: tenant-ingressgateway
  controlPlaneCidr: 0.0.0.0/0
